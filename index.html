<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¶–µ—Ü–æ - –ü—Ä–∞–≤–æ–ø–∏—Å–µ–Ω –ö–æ—Ä–µ–∫—Ç–æ—Ä</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    textarea { width: 80%; height: 150px; font-size: 16px; padding: 10px; }
    button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    #drop-area { border: 2px dashed #ccc; padding: 20px; margin: 10px auto; width: 80%; }
    #loading-status { font-weight: bold; margin-bottom: 10px; }
    #result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; min-height: 50px; }
    .error { color: red; font-weight: bold; text-decoration: underline; cursor: pointer; }
    .corrected { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h2>üöÄ –¶–µ—Ü–æ - –ü—Ä–∞–≤–æ–ø–∏—Å–µ–Ω –ö–æ—Ä–µ–∫—Ç–æ—Ä</h2>
  <div id="loading-status">–ó–∞—Ä–µ–∂–¥–∞–º —Ä–µ—á–Ω–∏–∫–∞...</div>
  <textarea id="textInput" placeholder="–ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç —Ç—É–∫..."></textarea>
  <br>
  <div id="drop-area">üìÇ –í–ª–∞—á–∏ –∏ –ø—É—Å–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤ —Ñ–∞–π–ª —Ç—É–∫</div>
  <button onclick="checkText()">üîç –ü—Ä–æ–≤–µ—Ä–∏ —Ç–µ–∫—Å—Ç</button>
  <button onclick="autoCorrectText()">üõ† –ü–æ–ø—Ä–∞–≤–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</button>
  <button onclick="downloadText()">üì• –°–≤–∞–ª–∏ –∫–æ—Ä–∏–≥–∏—Ä–∞–Ω–∏—è —Ç–µ–∫—Å—Ç</button>
  <div id="result"></div>

  <script>
    let bulgarianWords = [];
    const suggestions = { "–∞—Å": "–∞–∑", "–Ω–µ–º–æ–≥–∞": "–Ω–µ –º–æ–≥–∞", "—á–µ—Ç—è": "—á–µ—Ç–∞", "–≤—Å–µ–∫–∏–¥–µ–Ω": "–≤—Å–µ–∫–∏ –¥–µ–Ω" };

    async function loadDictionary() {
      try {
        const response = await fetch('bulgarian_dict.txt');
        const text = await response.text();
        bulgarianWords = text.split("\n").map(word => word.trim().toLowerCase());
        console.log("‚úÖ –†–µ—á–Ω–∏–∫ –∑–∞—Ä–µ–¥–µ–Ω:", bulgarianWords.length, "–¥—É–º–∏");
        document.getElementById("loading-status").innerText = "–†–µ—á–Ω–∏–∫—ä—Ç –µ –∑–∞—Ä–µ–¥–µ–Ω! ‚úÖ";
      } catch (e) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ä–µ—á–Ω–∏–∫–∞:", e);
        document.getElementById("loading-status").innerText = "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ!";
      }
    }

    function checkText() {
      const inputText = document.getElementById("textInput").value;
      const words = inputText.split(/(\s+)/);
      let correctedText = "";
      let hasErrors = false;

      let markedText = words.map(word => {
        let cleanWord = word.replace(/[^\p{L}]/gu, '').toLowerCase();
        console.log("üîç –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º –¥—É–º–∞:", cleanWord);

        if (cleanWord && !bulgarianWords.includes(cleanWord)) {
          console.log("‚ùå –ù–ï –ï –≤ —Ä–µ—á–Ω–∏–∫–∞:", cleanWord);
          hasErrors = true;
          let suggestion = suggestions[cleanWord] || "?";
          correctedText += `[${suggestion}] `;
          return `<span class='error' title='–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: ${suggestion}'>${word}</span>`;
        } else {
          correctedText += word;
          console.log("‚úÖ –ù–∞–º–µ—Ä–µ–Ω–∞ –≤ —Ä–µ—á–Ω–∏–∫–∞:", cleanWord);
          return word;
        }
      }).join('');

      document.getElementById("textInput").innerHTML = markedText;
      document.getElementById("result").innerText = hasErrors ? correctedText.trim() : "‚úÖ –ù—è–º–∞ –≥—Ä–µ—à–∫–∏!";
    }

    function autoCorrectText() {
      let inputText = document.getElementById("textInput").value;
      let words = inputText.split(/(\s+)/);

      let autoCorrectedText = words.map(word => {
        let cleanWord = word.replace(/[^\p{L}]/gu, '').toLowerCase();
        return suggestions[cleanWord] ? suggestions[cleanWord] : word;
      }).join('');

      document.getElementById("textInput").value = autoCorrectedText;
      document.getElementById("result").innerText = "‚úÖ –¢–µ–∫—Å—Ç—ä—Ç –µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ—Ä–∏–≥–∏—Ä–∞–Ω!";
    }

    function downloadText() {
      const text = document.getElementById("result").innerText;
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "corrected_text.txt";
      a.click();
    }

    loadDictionary();
  </script>
</body>
</html>

