<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¶–µ—Ü–æ - –ü—Ä–∞–≤–æ–ø–∏—Å–µ–Ω –ö–æ—Ä–µ–∫—Ç–æ—Ä</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    textarea { width: 80%; height: 150px; font-size: 16px; padding: 10px; }
    button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    #drop-area { border: 2px dashed #ccc; padding: 20px; margin: 10px auto; width: 80%; }
    #loading-status { font-weight: bold; margin-bottom: 10px; }
    #result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; min-height: 50px; }
    .error { color: red; font-weight: bold; text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>
  <h2>üöÄ –¶–µ—Ü–æ - –ü—Ä–∞–≤–æ–ø–∏—Å–µ–Ω –ö–æ—Ä–µ–∫—Ç–æ—Ä</h2>
  <div id="loading-status">–ó–∞—Ä–µ–∂–¥–∞–º —Ä–µ—á–Ω–∏–∫–∞...</div>
  <textarea id="textInput" placeholder="–ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç —Ç—É–∫..."></textarea>
  <br>
  <div id="drop-area">üìÇ –í–ª–∞—á–∏ –∏ –ø—É—Å–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤ —Ñ–∞–π–ª —Ç—É–∫</div>
  <button onclick="checkText()">üîç –ü—Ä–æ–≤–µ—Ä–∏ —Ç–µ–∫—Å—Ç</button>
  <button onclick="autoCorrectText()">‚öôÔ∏è –ü–æ–ø—Ä–∞–≤–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</button>
  <button onclick="downloadText()">üì• –°–≤–∞–ª–∏ –∫–æ—Ä–∏–≥–∏—Ä–∞–Ω–∏—è —Ç–µ–∫—Å—Ç</button>
  <div id="result"></div>

  <script>
    let bulgarianWords = [];

    // ‚úÖ –ó–∞—Ä–µ–∂–¥–∞ —Ä–µ—á–Ω–∏–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ
    async function loadDictionary() {
      try {
        const response = await fetch('bulgarian_dict.txt');
        const text = await response.text();
        bulgarianWords = text.split("\n").map(word => word.trim().toLowerCase());
        console.log("‚úÖ –†–µ—á–Ω–∏–∫ –∑–∞—Ä–µ–¥–µ–Ω:", bulgarianWords.length, "–¥—É–º–∏");
        document.getElementById("loading-status").innerText = "–†–µ—á–Ω–∏–∫—ä—Ç –µ –∑–∞—Ä–µ–¥–µ–Ω! ‚úÖ";
      } catch (e) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ä–µ—á–Ω–∏–∫–∞:", e);
        document.getElementById("loading-status").innerText = "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ!";
      }
    }

    // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ–∫—Å—Ç–∞ –∑–∞ –≥—Ä–µ—à–∫–∏
    function checkText() {
      const inputText = document.getElementById("textInput").value;
      const words = inputText.split(/(\s+)/); 
      let correctedText = ""; 
      let hasErrors = false;

      let markedText = words.map(word => {
        let cleanWord = word.replace(/[^\p{L}]/gu, '').toLowerCase();
        console.log("üîç –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º –¥—É–º–∞:", cleanWord);

        if (cleanWord && !bulgarianWords.includes(cleanWord)) {
          console.log("‚ùå –ù–ï –ï –≤ —Ä–µ—á–Ω–∏–∫–∞:", cleanWord);
          hasErrors = true;
          correctedText += `[${word}] `; 
          return `<span class='error' title='–í—ä–∑–º–æ–∂–Ω–∞ –≥—Ä–µ—à–∫–∞'>${word}</span>`;
        } else {
          correctedText += word;
          console.log("‚úÖ –ù–∞–º–µ—Ä–µ–Ω–∞ –≤ —Ä–µ—á–Ω–∏–∫–∞:", cleanWord);
          return word;
        }
      }).join('');

      console.log("–ö–æ—Ä–∏–≥–∏—Ä–∞–Ω —Ç–µ–∫—Å—Ç:", correctedText);
      document.getElementById("result").innerHTML = hasErrors ? correctedText.trim() : "‚úÖ –ù—è–º–∞ –≥—Ä–µ—à–∫–∏!";
    }

    // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ—Ä–µ–∫—Ü–∏—è (–ø—Ä–µ–º–∞—Ö–≤–∞ –¥—É–º–∏ –∏–∑–≤—ä–Ω —Ä–µ—á–Ω–∏–∫–∞)
    function autoCorrectText() {
      const inputText = document.getElementById("textInput").value;
      const words = inputText.split(/\s+/);
      let correctedWords = words.map(word => {
        let cleanWord = word.replace(/[^\p{L}]/gu, '').toLowerCase();
        return bulgarianWords.includes(cleanWord) ? word : "";
      });
      document.getElementById("textInput").value = correctedWords.join(" ").trim();
      document.getElementById("result").innerText = "‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–µ–Ω–∞!";
    }

    // ‚úÖ –ü–æ–¥–¥—Ä—ä–∂–∫–∞ –Ω–∞ drag & drop –∑–∞ —Ñ–∞–π–ª–æ–≤–µ
    let dropArea = document.getElementById("drop-area");
    dropArea.addEventListener("dragover", e => { e.preventDefault(); });
    dropArea.addEventListener("drop", e => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = evt => { document.getElementById("textInput").value = evt.target.result; };
        reader.readAsText(file);
      }
    });

    // ‚úÖ –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–æ—Ä–∏–≥–∏—Ä–∞–Ω–∏—è —Ç–µ–∫—Å—Ç –∫–∞—Ç–æ —Ñ–∞–π–ª
    function downloadText() {
      const text = document.getElementById("textInput").value;
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "corrected_text.txt";
      a.click();
    }

    // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ä–µ—á–Ω–∏–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ
    loadDictionary();
  </script>
</body>
</html>

